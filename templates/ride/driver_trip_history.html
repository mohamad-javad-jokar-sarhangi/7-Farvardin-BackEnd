{% extends 'base.html' %}

{% block title %}ğŸ§¾ Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ±Ù‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡{% endblock %}

{% block content %}

<h2 style="text-align:center; color:var(--accent);">ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø³ÙØ±Ù‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù…â€ŒØ´Ø¯Ù‡</h2>

<form id="dateRangeForm" style="max-width:700px; margin:30px auto; text-align:center;">
    <div class="form-group">
        <label>Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
        <input type="datetime-local" id="startDate" name="startDate">
    </div>
    <div class="form-group">
        <label>ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
        <input type="datetime-local" id="endDate" name="endDate">
    </div>
    <button type="submit" class="button">Ù†Ù…Ø§ÛŒØ´ Ø³ÙØ±Ù‡Ø§ Ø¯Ø± Ø¨Ø§Ø²Ù‡</button>
</form>

<hr style="border-color:var(--table-border); margin:30px auto; width:80%;">

<h3 id="tripSummary" style="text-align:center;">Ø¢Ø®Ø±ÛŒÙ† Û±Û° Ø³ÙØ± Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</h3>

<table id="tripHistoryTable">
    <thead>
        <tr>
            <th>Ø±Ø§Ù†Ù†Ø¯Ù‡</th>
            <th>Ù…Ø³Ø§ÙØ±</th>
            <th>Ù…Ù†Ø·Ù‚Ù‡</th>
            <th>Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</th>
            <th>Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹</th>
            <th>Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù†</th>
        </tr>
    </thead>
    <tbody id="tripHistoryBody"></tbody>
</table>

<script>
async function loadTrips(startDate = null, endDate = null) {
    let url = "/ride/trip_history_api/";
    if (startDate && endDate) {
        url += `?start=${startDate}&end=${endDate}`;
    }

    const res = await fetch(url);
    const data = await res.json();

    const tbody = document.getElementById("tripHistoryBody");
    const summary = document.getElementById("tripSummary");
    tbody.innerHTML = "";

    if (data.trips && data.trips.length > 0) {
        summary.textContent = `ØªØ¹Ø¯Ø§Ø¯ Ø³ÙØ±Ù‡Ø§: ${data.trips.length}`;
        data.trips.forEach(t => {
            const row = `
                <tr>
                    <td>${t.driver}</td>
                    <td>${t.passenger}</td>
                    <td>${t.region}</td>
                    <td>${t.request_type}</td>
                    <td>${t.start_time}</td>
                    <td>${t.finish_time}</td>
                </tr>`;
            tbody.innerHTML += row;
        });
    } else {
        summary.textContent = "Ù‡ÛŒÚ† Ø³ÙØ±ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.";
    }
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ (Ø¢Ø®Ø±ÛŒÙ† 10 Ø³ÙØ±)
window.addEventListener('load', () => loadTrips());

// ÙÛŒÙ„ØªØ± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ
document.getElementById('dateRangeForm').addEventListener('submit', e => {
    e.preventDefault();
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    if (!start || !end) {
        alert('Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
        return;
    }
    loadTrips(start, end);
});
</script>

{% endblock %}
