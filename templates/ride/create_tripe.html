{% extends "base.html" %}
{% block title %}Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯{% endblock %}
{% block content %}
<h2>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± Ø¬Ø¯ÛŒØ¯</h2>

<form method="POST" class="request-form">
    {% csrf_token %}

    <div class="form-group">
        <label for="passenger_search">Ù†Ø§Ù… Ù…Ø³Ø§ÙØ±:</label>
        <input type="text" id="passenger_search" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… Ù…Ø³Ø§ÙØ±..." autocomplete="off">

        <label>Ù…Ø¨Ø¯Ø£:</label>
        <input type="text" name="origin" required>

        <label>Ù…Ù‚ØµØ¯:</label>
        <input type="text" name="destination" required>

        <!-- Ø²Ù…Ø§Ù† Ùˆ ØªØ§Ø±ÛŒØ® ÙØ¹Ù„ÛŒ -->
        <label>ØªØ§Ø±ÛŒØ®:</label>
        <input type="date" name="request_date" id="request_date">
        <label>Ø²Ù…Ø§Ù†:</label>
        <input type="time" name="request_time" id="request_time">

        <input type="hidden" name="user_id" id="selected_user_id">
        <div id="suggestions" class="suggestions-list"></div>
    </div>

    <div class="form-group">
        <label for="request_type">Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª:</label>
        <select name="request_type" id="request_type">
            <option value="normal">Normal</option>
            <option value="hurryup">Hurry Up</option>
            <option value="vip">VIP</option>
        </select>
    </div>

    <button type="submit" class="button">Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
</form>

<a href="{% url 'current_tripes' %}" class="button">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</a>

<script>
const input = document.getElementById("passenger_search");
const suggestionsBox = document.getElementById("suggestions");

// ğŸ•’ ØªÙ†Ø¸ÛŒÙ… Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ
window.addEventListener("load", () => {
    const now = new Date();
    document.getElementById("request_date").value = now.toISOString().split("T")[0];
    document.getElementById("request_time").value = now.toTimeString().slice(0,5);
});

input.addEventListener("input", async () => {
    const q = input.value.trim();
    if (q.length < 2) {
        suggestionsBox.innerHTML = "";
        return;
    }
    const response = await fetch(`/ride/search-passengers/?q=${q}`);
    const results = await response.json();

    suggestionsBox.innerHTML = "";
    results.forEach(user => {
        const div = document.createElement("div");
        div.className = "suggest-item";
        div.textContent = `${user.name} - ${user.phone}`;
        div.onclick = () => {
            input.value = user.name;
            document.getElementById("selected_user_id").value = user.id;
            suggestionsBox.innerHTML = "";
        };
        suggestionsBox.appendChild(div);
    });
});
</script>

<style>
.suggestions-list {
    border: 1px solid #ccc;
    max-height: 180px;
    overflow-y: auto;
    background: #fff;
    position: absolute;
    width: 300px;
    z-index: 10;
}
.suggest-item {
    padding: 5px;
    cursor: pointer;
}
.suggest-item:hover { background: #eef; }
</style>
{% endblock %}
